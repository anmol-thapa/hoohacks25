<!-- public/index.html -->


<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Gemini Chatbot</title>
 <style>
   body {
     font-family: Arial, sans-serif;
     max-width: 800px;
     margin: 0 auto;
     padding: 20px;
     background-color: #f5f5f5;
   }
  
   .chat-container {
     background-color: white;
     border-radius: 10px;
     box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
     overflow: hidden;
     display: flex;
     flex-direction: column;
     height: 80vh;
   }
  
   .chat-header {
     background-color: #4285f4;
     color: white;
     padding: 15px;
     text-align: center;
     font-weight: bold;
   }
  
   .messages {
     flex: 1;
     overflow-y: auto;
     padding: 15px;
   }
  
   .message {
     margin-bottom: 15px;
     padding: 10px 15px;
     border-radius: 18px;
     max-width: 70%;
     word-wrap: break-word;
   }
  
   .user-message {
     background-color: #e2f0fd;
     align-self: flex-end;
     margin-left: auto;
   }
  
   .bot-message {
     background-color: #f0f0f0;
     align-self: flex-start;
   }
  
   .message-container {
     display: flex;
     margin-bottom: 10px;
   }
  
   .input-area {
     display: flex;
     padding: 15px;
     background-color: #f8f8f8;
     border-top: 1px solid #ddd;
   }
  
   #user-input {
     flex: 1;
     padding: 10px 15px;
     border: 1px solid #ddd;
     border-radius: 20px;
     outline: none;
   }
  
   button {
     background-color: #4285f4;
     color: white;
     border: none;
     border-radius: 20px;
     padding: 10px 20px;
     margin-left: 10px;
     cursor: pointer;
   }
  
   .thinking {
     font-style: italic;
     color: #888;
   }

   .chat {
    gap: 30px;
   }
 </style>
</head>
<body>
<div style="display: flex; align-items: flex-start; gap: 60px;">


   <!-- LEFT SIDE (Avatar & Exit button) -->
   <div style="display: flex; flex-direction: column; align-items: center;">


     <!-- Exit Button -->
     <div style="align-self: flex-start; margin-bottom: 10px; padding:50px 60px;">
       <img src="exit.png" alt="Exit" style="width: 50px; cursor: pointer;" onclick="exitChat()">
     </div>


     <!-- Assistant Avatar -->
     <div>
       <img src="chat1.png" alt="Sleeping Assistant" style="width: 300px; border-radius: 10px;">
     </div>


   </div>


 <div class="chat-container">
   <div class="chat-header">
     Sleeping Buddy
   </div>
   <div class="messages" id="messages">
     <div class="message-container">
       <div class="message bot-message">
         Hi there! I'm a chatbot powered by Gemini AI. How can I help you today?
       </div>
     </div>
   </div>
   <div class="input-area">
     <input type="text" id="user-input" placeholder="Type your message here..." autocomplete="off">
     <button id="send-button">Send</button>
   </div>
 </div>


 <script>
   const apiUrl = "http://127.0.0.1:5000/api/chat";


   const messagesContainer = document.getElementById('messages');
   const userInput = document.getElementById('user-input');
   const sendButton = document.getElementById('send-button');


   sendButton.addEventListener('click', sendMessage);
   userInput.addEventListener('keypress', (e) => {
       if (e.key === 'Enter') {
           sendMessage();
       }
   });


   function addMessage(text, isUser) {
       const messageContainer = document.createElement('div');
       messageContainer.className = 'message-container';


       const messageElement = document.createElement('div');
       messageElement.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
       messageElement.textContent = text;


       messageContainer.appendChild(messageElement);
       messagesContainer.appendChild(messageContainer);
       messagesContainer.scrollTop = messagesContainer.scrollHeight;
   }


   function showThinking() {
       const thinkingContainer = document.createElement('div');
       thinkingContainer.className = 'message-container';
       thinkingContainer.id = 'thinking-indicator';


       const thinkingElement = document.createElement('div');
       thinkingElement.className = 'message bot-message thinking';
       thinkingElement.textContent = 'Thinking...';


       thinkingContainer.appendChild(thinkingElement);
       messagesContainer.appendChild(thinkingContainer);
       messagesContainer.scrollTop = messagesContainer.scrollHeight;
   }


   function removeThinking() {
       const thinkingIndicator = document.getElementById('thinking-indicator');
       if (thinkingIndicator) {
           thinkingIndicator.remove();
       }
   }
   async function sendMessage() {
   const message = userInput.value.trim();
   if (!message) return;


   addMessage(message, true);
   userInput.value = '';


   showThinking();
  
  
   try {
       const response = await fetch(apiUrl, {
           method: "POST",
           headers: {
               "Content-Type": "application/json"
           },
           body: JSON.stringify({
           message: message
         })
       });


       const data = await response.json();
       removeThinking();
      
// Extract the message from the JSON response
const apiMessage = data?.candidates?.[0]?.content?.parts?.[0]?.text;


if (apiMessage) {
   // Use regex to safely split into sentences (periods, exclamations, or questions)
   const sentences = apiMessage.match(/[^.!?]+[.!?]/g) || [];


   // Take the first 2 full sentences (or less if not available)
   const shortMessage = sentences.slice(0, 2).join(' ').trim();


   addMessage(shortMessage, false);
} else {
   addMessage('No response from API.', false);
}
   } catch (error) {
       console.error('Error:', error);
       removeThinking();
       addMessage('Error contacting API.', false);
   }
}
</script>
</body>
</html>
